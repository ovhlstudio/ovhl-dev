import { IAuditIssue } from '../Types/AuditResult.js';

export class ScoringEngine {
    static calculate(currentScore: number, issues: IAuditIssue[]): number {
        let newScore = currentScore;
        
        const penaltyByTitle: { [key: string]: number } = {};
        const MAX_PENALTY_PER_TYPE = 20; 

        issues.forEach(issue => {
            const p = issue.penalty || 0;
            const t = issue.title;
            if (!penaltyByTitle[t]) penaltyByTitle[t] = 0;
            if (penaltyByTitle[t] < MAX_PENALTY_PER_TYPE) {
                const remaining = MAX_PENALTY_PER_TYPE - penaltyByTitle[t];
                const deduct = Math.min(p, remaining);
                penaltyByTitle[t] += deduct;
                newScore -= deduct;
            }
        });

        return Math.max(0, newScore);
    }

    static getGrade(score: number): string {
        if (score >= 90) return 'A';
        if (score >= 80) return 'B';
        if (score >= 70) return 'C';
        if (score >= 60) return 'D';
        return 'F';
    }
}